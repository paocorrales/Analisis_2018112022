file[, u := - V*sin(direccionViento_grados*pi/180)]
file[, v := - V*cos(direccionViento_grados*pi/180)]
file <- file[, c("latitud_grados", "longitud_grados", "altura_mts", "estacion_codigo", "muestra_UTC", "temperatura_centigrados",
"q", "u", "v", "p")]
colnames(file) <- c("LAT", "LON", "ELV", "STATION", "DATE", "TOB", "QOB", "UOB", "VOB", "PRSS")
# Algo de QC
file <- file[ (LAT %between% c(-90, 0))  & LON < 0 ]
#file <- file[ (LAT %between% c(-90, 0))  & LON < 0 & !is.na(PRSS) & PRSS > 200 ]
file[is.na(file)] <- 10.0e10
# guardo el archivo
fwrite(file, paste0("../../datos/out/", date, "/", i), na = '10.0e10', col.names = FALSE)
}
path <- "../../datos/mesonet/"
date <- "20181122"
filelist <- list.files(path = paste0(path, date))
for (i in filelist) {
file <- fread(paste0(path, date, "/", i), na.strings = c("NaN", "None", "Invalid", "-"))
# Tiro pp
pp <- c("precipitacion24horas_mm", "precipitacion6horas_mm", "precipitacion1hora_mm", "precipitacion10minutos_mm")
file[, (pp) := NULL]
# Calculo q y convierto las variables a lo que necesito
file[, tk := temperatura_centigrados + 273.15]
file[, p := presion_hPa*100]
file[, es := ClausiusClapeyron(tk)]
file[, e := humedad_porcentaje*es/100]
file[, q := MixingRatio(p = presion_hPa*100, e = e)]
file[, V := velocidadViento_km_hora*1000/3600]
file[, u := - V*sin(direccionViento_grados*pi/180)]
file[, v := - V*cos(direccionViento_grados*pi/180)]
file <- file[, c("latitud_grados", "longitud_grados", "altura_mts", "estacion_codigo", "muestra_UTC", "temperatura_centigrados",
"q", "u", "v", "p")]
colnames(file) <- c("LAT", "LON", "ELV", "STATION", "DATE", "TOB", "QOB", "UOB", "VOB", "PRSS")
# Algo de QC
file <- file[ (LAT %between% c(-90, 0))  & LON < 0 ]
#file <- file[ (LAT %between% c(-90, 0))  & LON < 0 & !is.na(PRSS) & PRSS > 200 ]
file[is.na(file)] <- 10.0e10
# guardo el archivo
fwrite(file, paste0("../../datos/out/", date, "/", i), na = '10.0e10', col.names = FALSE)
}
path <- "../../datos/mesonet/"
date <- "20181123"
filelist <- list.files(path = paste0(path, date))
for (i in filelist) {
file <- fread(paste0(path, date, "/", i), na.strings = c("NaN", "None", "Invalid", "-"))
# Tiro pp
pp <- c("precipitacion24horas_mm", "precipitacion6horas_mm", "precipitacion1hora_mm", "precipitacion10minutos_mm")
file[, (pp) := NULL]
# Calculo q y convierto las variables a lo que necesito
file[, tk := temperatura_centigrados + 273.15]
file[, p := presion_hPa*100]
file[, es := ClausiusClapeyron(tk)]
file[, e := humedad_porcentaje*es/100]
file[, q := MixingRatio(p = presion_hPa*100, e = e)]
file[, V := velocidadViento_km_hora*1000/3600]
file[, u := - V*sin(direccionViento_grados*pi/180)]
file[, v := - V*cos(direccionViento_grados*pi/180)]
file <- file[, c("latitud_grados", "longitud_grados", "altura_mts", "estacion_codigo", "muestra_UTC", "temperatura_centigrados",
"q", "u", "v", "p")]
colnames(file) <- c("LAT", "LON", "ELV", "STATION", "DATE", "TOB", "QOB", "UOB", "VOB", "PRSS")
# Algo de QC
file <- file[ (LAT %between% c(-90, 0))  & LON < 0 ]
#file <- file[ (LAT %between% c(-90, 0))  & LON < 0 & !is.na(PRSS) & PRSS > 200 ]
file[is.na(file)] <- 10.0e10
# guardo el archivo
fwrite(file, paste0("../../datos/out/", date, "/", i), na = '10.0e10', col.names = FALSE)
}
306.897-273.5
10.0e10
100000000000
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(metR)
library(data.table)
library(dplyr)
library(lubridate)
library(patchwork)
map <- rnaturalearth::ne_states(country = c("argentina", "Brazil", "Chile", "Uruguay", "Paraguay", "Bolivia"), returnclass = "sf")
proj <- paste0("+proj=lcc +lat_1=-30.966 +lat_2=-30.966 +lat_0=-30.966 +lon_0=-63.567",
" +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs")
diag <- fread("E1/test/test.csv")
View(diag)
diag <- fread("E1/test/test.csv", na.strings = c("0.100E+11", "-0.100E+06", "-99999.90", "-100000.00"))
View(diag)
knitr::opts_chunk$set(echo = TRUE)
diag <- fread("E1/test/test.csv", na.strings = c("0.100E+11", "-0.100E+06", "-99999.90", "-100000.00"))
1/diag$rerr
diag$rerr
knitr::opts_chunk$set(echo = TRUE)
library(data.table)
library(dplyr)
diag <- fread("E1/test/test.csv", na.strings = c("0.100E+11", "-0.100E+06", "-99999.90", "-100000.00")) %>%
.[, c("V2", "V4") := NULL]
colnames(diag) <- c("var", "stationID", "type", "dhr", "lat", "lon", "pressure", "usage.flag", "obs", "obs.guess", "obs2", "obs.guess2", "rerr")
diag$rerr
1/diag$rerr
knitr::opts_chunk$set(echo = TRUE)
library(data.table)
library(dplyr)
library(metR)
GlanceNetCDF("E1/test/ana.nc")
a <- GlanceNetCDF("E1/test/ana.nc")
View(a)
a <- ncdf4::nc_open(file)("E1/test/ana.nc")
a <- ncdf4::nc_open("E1/test/ana.nc")
View(a)
ana <- ReadNetCDF("E1/test/ana.nc", vars = c("T", "MU", "XLAT", "XLONG"),
subset = list(lat = -35:-26, lon = -67:-59))
View(a)
ana <- ReadNetCDF("E1/test/ana.nc", vars = c("T", "MU", "XLAT", "XLONG"),
subset = list(south_north = 100:140, west_east = 80:120))
ana <- ReadNetCDF("E1/test/ana.nc", vars = c("T", "MU", "XLAT", "XLONG"),
subset = list(south_north = 100:140, west_east = 80:120, bottom_top = 1:5))
files <- Sys.glob("E1/test/*.nc")
substr(basename(files[1]), nchar(files[1])-3, nchar(files[1]))
basename(files[1])
gsub("nc", "", "ana.nc")
gsub(".nc", "", "ana.nc")
ReadNetCDF(f, vars = c("T", "MU", "XLAT", "XLONG"),
subset = list(south_north = 100:140, west_east = 80:120, bottom_top = 1:5)) %>%
.[, model := gsub(".nc", "", basemane(f))]
model <- lapply(files, function(f) {
ReadNetCDF(f, vars = c("T", "MU", "XLAT", "XLONG"),
subset = list(south_north = 100:140, west_east = 80:120, bottom_top = 1:5)) %>%
.[, model := gsub(".nc", "", basemane(f))]
}) %>%
rbindlist()
model <- lapply(files, function(f) {
ReadNetCDF(f, vars = c("T", "MU", "XLAT", "XLONG"),
subset = list(south_north = 100:140, west_east = 80:120, bottom_top = 1:5)) %>%
.[, model := gsub(".nc", "", basename(f))]
}) %>%
rbindlist()
unique(model$bottom_top)
model[bottom_top == 1] %>%
ggplot(aes(XLAT, XLONG)) %>%
geom_point(aes(color = T))
model[bottom_top == 1] %>%
ggplot(aes(XLAT, XLONG)) +
geom_point(aes(color = T))
model[bottom_top == 1] %>%
ggplot(aes(XLAT, XLONG)) +
geom_tile(aes(fill = T)) +
scale_color_viridis_c()
model[bottom_top == 1] %>%
ggplot(aes(XLAT, XLONG)) +
geom_raster(aes(fill = T)) +
scale_color_viridis_c()
model[bottom_top == 1] %>%
ggplot(aes(XLAT, XLONG)) +
geom_rect(aes(fill = T)) +
scale_color_viridis_c()
model[bottom_top == 1] %>%
ggplot(aes(XLAT, XLONG)) +
geom_tile(aes(fill = T)) +
scale_color_viridis_c()
model[bottom_top == 1] %>%
ggplot(aes(XLAT, XLONG)) +
geom_tile(aes(fill = T)) +
scale_color_viridis_c()
model[bottom_top == 1]
model[bottom_top == 1] %>%
ggplot(aes(XLAT, XLONG)) +
geom_point(aes(color = T)) +
scale_color_viridis_c()
model[bottom_top == 1] %>%
ggplot(aes(west_east, south_north)) +
geom_point(aes(color = T)) +
scale_color_viridis_c()
model[bottom_top == 1] %>%
ggplot(aes(west_east, south_north)) +
geom_tile(aes(fill = T)) +
scale_color_viridis_c()
model[bottom_top == 1] %>%
ggplot(aes(west_east, south_north)) +
geom_contour(aes(fill = T)) +
scale_color_viridis_c()
model[bottom_top == 1] %>%
ggplot(aes(west_east, south_north)) +
geom_contour(aes(z = T)) +
scale_color_viridis_c()
model[bottom_top == 1 & model == "guess"] %>%
ggplot(aes(west_east, south_north)) +
geom_contour(aes(z = T)) +
scale_color_viridis_c()
model[bottom_top == 1 & model == "guess"] %>%
ggplot(aes(west_east, south_north)) +
geom_contour_fill(aes(z = T)) +
scale_color_viridis_c()
model[bottom_top == 1 & model == "guess"] %>%
ggplot(aes(west_east, south_north)) +
geom_contour_fill(aes(z = T + 290 -273.15)) +
scale_color_viridis_c()
model[bottom_top == 1 & model == "guess"] %>%
ggplot(aes(west_east, south_north)) +
geom_contour_fill(aes(z = T + 290 -273.15)) +
scale_color_viridis_c() +
coord_fixed()
model[bottom_top == 1 & model == "ana"] %>%
ggplot(aes(west_east, south_north)) +
geom_contour_fill(aes(z = T + 290 -273.15)) +
scale_color_viridis_c() +
coord_fixed()
model <- ReadNetCDF("E1/test/ana.nc", vars = c("T", "MU", "XLAT", "XLONG"),
subset = list(south_north = 100:140, west_east = 80:120, bottom_top = 1:5)) %>%
.[, c("T_guess", "MU_guess" ):= ReadNetCDF("E1/test/guess.nc", vars = c("T", "MU"),
out = "vector",
subset = list(south_north = 100:140, west_east = 80:120, bottom_top = 1:5))]
ReadNetCDF("E1/test/guess.nc", vars = c("T", "MU"),
out = "vector",
subset = list(south_north = 100:140, west_east = 80:120, bottom_top = 1:5))
GlanceNetCDF("E1/test/guess.nc")
model <- lapply(files, function(f) {
ReadNetCDF(f, vars = c("T", "MU", "XLAT", "XLONG"),
subset = list(south_north = 100:140, west_east = 80:120, bottom_top = 1:5)) %>%
.[, model := gsub(".nc", "", basename(f))]
}) %>%
rbindlist()
model
dcast(model, bottom_top + south_north + west_east ~ model, value.var = "T")
tidyr::spread(model, model, T)
models <- model
tidyr::spread(models, model, T)
dcast(model, bottom_top + south_north + west_east ~ model, value.var = "T") %>%
.[bottom_top == 1] %>%
ggplot(aes(west_east, south_north)) +
geom_contour_fill(aes(z = (ana - guess) + 290 -273.15)) +
scale_color_viridis_c() +
coord_fixed()
dcast(model, bottom_top + south_north + west_east ~ model, value.var = "T") %>%
.[bottom_top == 1] %>%
ggplot(aes(west_east, south_north)) +
geom_contour_fill(aes(z = (ana - guess) + 290 -273.15)) +
scale_fill_viridis_c() +
coord_fixed()
ReadNetCDF(f, vars = c("T", "MU", "XLAT", "XLONG"),
subset = list(south_north = 90:150, west_east = 70:130, bottom_top = 1:5)) %>%
.[, model := gsub(".nc", "", basename(f))]
model <- lapply(files, function(f) {
ReadNetCDF(f, vars = c("T", "MU", "XLAT", "XLONG"),
subset = list(south_north = 90:150, west_east = 70:130, bottom_top = 1:5)) %>%
.[, model := gsub(".nc", "", basename(f))]
}) %>%
rbindlist()
dcast(model, bottom_top + south_north + west_east ~ model, value.var = "T") %>%
.[bottom_top == 1] %>%
ggplot(aes(west_east, south_north)) +
geom_contour_fill(aes(z = (ana - guess) + 290 -273.15)) +
scale_fill_viridis_c() +
coord_fixed()
model <- lapply(files, function(f) {
ReadNetCDF(f, vars = c("T", "MU", "XLAT", "XLONG"),
subset = list(bottom_top = 1:5)) %>%
.[, model := gsub(".nc", "", basename(f))]
}) %>%
rbindlist()
dcast(model, bottom_top + south_north + west_east ~ model, value.var = "T") %>%
.[bottom_top == 1] %>%
ggplot(aes(west_east, south_north)) +
geom_contour_fill(aes(z = (ana - guess) + 290 -273.15)) +
scale_fill_viridis_c() +
coord_fixed()
dcast(model, bottom_top + south_north + west_east ~ model, value.var = "T") %>%
.[bottom_top == 1] %>%
ggplot(aes(west_east, south_north)) +
geom_contour_fill(aes(z = (ana - guess))) +
scale_fill_viridis_c() +
coord_fixed()
dcast(model, bottom_top + south_north + west_east ~ model, value.var = "MU") %>%
.[bottom_top == 1] %>%
ggplot(aes(west_east, south_north)) +
geom_contour_fill(aes(z = (ana - guess))) +
scale_fill_viridis_c() +
coord_fixed()
library(patchwork)
knitr::opts_chunk$set(echo = TRUE)
library(data.table)
library(dplyr)
library(metR)
library(patchwork)
library(ggplot2)
dcast(model, bottom_top + south_north + west_east ~ model, value.var = "T") %>%
.[bottom_top == 1] %>%
ggplot(aes(west_east, south_north)) +
geom_contour_fill(aes(z = (ana - guess))) +
scale_fill_viridis_c() +
coord_fixed() +
labs("ana-guess en la perturbación de \nla temperatura potencial \n(theta-t0") +
dcast(model, bottom_top + south_north + west_east ~ model, value.var = "MU") %>%
.[bottom_top == 1] %>%
ggplot(aes(west_east, south_north)) +
geom_contour_fill(aes(z = (ana - guess))) +
scale_fill_viridis_c() +
coord_fixed() +
labs("ana-guess en la perturbación de \nla de la masa de aire seco \n(theta-t0")
dcast(model, bottom_top + south_north + west_east ~ model, value.var = "T") %>%
.[bottom_top == 1] %>%
ggplot(aes(west_east, south_north)) +
geom_contour_fill(aes(z = (ana - guess))) +
scale_fill_viridis_c() +
coord_fixed() +
labs(title = "ana-guess en la perturbación de \nla temperatura potencial \n(theta-t0") +
dcast(model, bottom_top + south_north + west_east ~ model, value.var = "MU") %>%
.[bottom_top == 1] %>%
ggplot(aes(west_east, south_north)) +
geom_contour_fill(aes(z = (ana - guess))) +
scale_fill_viridis_c() +
coord_fixed() +
labs(title = "ana-guess en la perturbación de \nla de la masa de aire seco \n(theta-t0")
model <- lapply(files, function(f) {
ReadNetCDF(f, vars = c("U", "V"),
subset = list(bottom_top = 1:5)) %>%
.[, model := gsub(".nc", "", basename(f))]
}) %>%
rbindlist()
ReadNetCDF(f, vars = c("U"),
subset = list(bottom_top = 1:5)) %>%
.[, model := gsub(".nc", "", basename(f))]
model <- lapply(files, function(f) {
ReadNetCDF(f, vars = c("U"),
subset = list(bottom_top = 1:5)) %>%
.[, model := gsub(".nc", "", basename(f))]
}) %>%
rbindlist()
dcast(model, bottom_top + south_north + west_east ~ model, value.var = "U") %>%
.[bottom_top == 1] %>%
ggplot(aes(west_east, south_north)) +
geom_contour_fill(aes(z = (ana - guess))) +
scale_fill_viridis_c() +
coord_fixed() +
labs(title = "ana-guess en la perturbación de \nla temperatura potencial \n(theta-t0 en K)") +
dcast(model, bottom_top + south_north + west_east ~ model, value.var = "V") %>%
.[bottom_top == 1] %>%
ggplot(aes(west_east, south_north)) +
geom_contour_fill(aes(z = (ana - guess))) +
scale_fill_viridis_c() +
coord_fixed() +
labs(title = "ana-guess en la perturbación de \nla de la masa de aire seco (Pa)")
model <- lapply(files, function(f) {
ReadNetCDF(f, vars = c("U"),
subset = list(bottom_top = 1:5)) %>%
.[, model := gsub(".nc", "", basename(f))]
}) %>%
rbindlist()
dcast(model, bottom_top + south_north + west_east_stag ~ model, value.var = "U") %>%
.[bottom_top == 1] %>%
ggplot(aes(west_east, south_north)) +
geom_contour_fill(aes(z = (ana - guess))) +
scale_fill_viridis_c() +
coord_fixed() +
labs(title = "ana-guess en la perturbación de \nla temperatura potencial \n(theta-t0 en K)")
dcast(model, bottom_top + south_north + west_east_stag ~ model, value.var = "U") %>%
.[bottom_top == 1] %>%
ggplot(aes(west_east_stag, south_north)) +
geom_contour_fill(aes(z = (ana - guess))) +
scale_fill_viridis_c() +
coord_fixed() +
labs(title = "ana-guess en la perturbación de \nla temperatura potencial \n(theta-t0 en K)")
files <- Sys.glob("E1/test/*.nc")
model <- lapply(files, function(f) {
ReadNetCDF(f, vars = c("T", "MU"),
subset = list(bottom_top = 1:5)) %>%
.[, model := gsub(".nc", "", basename(f))]
}) %>%
rbindlist()
unique(model$model)
dcast(model, bottom_top + south_north + west_east ~ model, value.var = "T") %>%
.[bottom_top == 1] %>%
ggplot(aes(west_east, south_north)) +
geom_contour_fill(aes(z = (ana187 - guess))) +
scale_fill_viridis_c() +
coord_fixed() +
labs(title = "ana-guess en la perturbación de \nla temperatura potencial \n(theta-t0 en K)") +
dcast(model, bottom_top + south_north + west_east ~ model, value.var = "T") %>%
.[bottom_top == 1] %>%
ggplot(aes(west_east, south_north)) +
geom_contour_fill(aes(z = (ana - guess))) +
scale_fill_viridis_c() +
coord_fixed() +
labs(title = "ana-guess en la perturbación de \nla de la masa de aire seco (Pa)")
dcast(model, bottom_top + south_north + west_east ~ model, value.var = "T") %>%
.[bottom_top == 1] %>%
ggplot(aes(west_east, south_north)) +
geom_contour_fill(aes(z = (ana187 - guess))) +
scale_fill_viridis_c() +
coord_fixed() +
labs(title = "ana-guess en la perturbación de \nla temperatura potencial \n(theta-t0 en K)")
model[bottom_top == 1] %>%
dcast(bottom_top + south_north + west_east ~ model, value.var = "T") %>%
ggplot(aes(west_east, south_north)) +
geom_contour_fill(aes(z = (ana187 - guess))) +
scale_fill_viridis_c() +
coord_fixed() +
labs(title = "ana-guess en la perturbación de \nla temperatura potencial \n(theta-t0 en K)")
model[bottom_top == 1] %>%
dcast(bottom_top + south_north + west_east ~ model, value.var = "T")
model[bottom_top == 1] %>%
dcast(bottom_top + south_north + west_east ~ model, value.var = "T") %>%
ggplot(aes(west_east, south_north)) +
geom_contour_fill(aes(z = (ana187))) +
scale_fill_viridis_c() +
coord_fixed() +
labs(title = "ana-guess en la perturbación de \nla temperatura potencial \n(theta-t0 en K)")
model[bottom_top == 1] %>%
dcast(bottom_top + south_north + west_east ~ model, value.var = "T") %>%
ggplot(aes(west_east, south_north)) +
geom_contour_fill(aes(z = (ana187 - guess))) +
scale_fill_viridis_c() +
coord_fixed() +
labs(title = "ana-guess en la perturbación de \nla temperatura potencial \n(theta-t0 en K)")
model[bottom_top == 1] %>%
dcast(bottom_top + south_north + west_east ~ model, value.var = "T") %>%
ggplot(aes(west_east, south_north)) +
geom_contour(aes(z = (ana187 - guess))) +
scale_fill_viridis_c() +
coord_fixed() +
labs(title = "ana-guess en la perturbación de \nla temperatura potencial \n(theta-t0 en K)")
model[bottom_top == 1] %>%
dcast(bottom_top + south_north + west_east ~ model, value.var = "T")
model[bottom_top == 1] %>%
dcast(bottom_top + south_north + west_east ~ model, value.var = "T") %>%
ggplot(aes(west_east, south_north)) +
geom_contour_fill(aes(z = (ana187))) +
scale_fill_viridis_c() +
coord_fixed() +
labs(title = "ana-guess en la perturbación de \nla temperatura potencial \n(theta-t0 en K)")
model[bottom_top == 1] %>%
dcast(bottom_top + south_north + west_east ~ model, value.var = "T") %>%
ggplot(aes(west_east, south_north)) +
geom_contour(aes(z = (ana187 - guess))) +
scale_fill_viridis_c() +
coord_fixed() +
labs(title = "ana-guess en la perturbación de \nla temperatura potencial \n(theta-t0 en K)")
model[bottom_top == 1] %>%
dcast(bottom_top + south_north + west_east ~ model, value.var = "MU") %>%
ggplot(aes(west_east, south_north)) +
geom_contour(aes(z = (ana187 - guess))) +
scale_fill_viridis_c() +
coord_fixed() +
labs(title = "ana-guess en la perturbación de \nla temperatura potencial \n(theta-t0 en K)")
a <-dcast(bottom_top + south_north + west_east ~ model, value.var = "T")
a <-dcast(model, bottom_top + south_north + west_east ~ model, value.var = "T")
a$ana187-a$guess
range(a$ana187-a$guess)
model <- lapply(files, function(f) {
ReadNetCDF(f, vars = c("U"),
subset = list(bottom_top = 1:5)) %>%
.[, model := gsub(".nc", "", basename(f))]
}) %>%
rbindlist()
dcast(model, bottom_top + south_north + west_east_stag ~ model, value.var = "U") %>%
.[bottom_top == 1] %>%
ggplot(aes(west_east_stag, south_north)) +
geom_contour_fill(aes(z = (ana187 - guess))) +
scale_fill_viridis_c() +
coord_fixed() +
labs(title = "ana-guess en el viento zonal")
model <- lapply(files, function(f) {
ReadNetCDF(f, vars = c("U"),
subset = list(bottom_top = 1:5)) %>%
.[, model := gsub(".nc", "", basename(f))]
}) %>%
rbindlist()
dcast(model, bottom_top + south_north + west_east_stag ~ model, value.var = "U")
dcast(model, bottom_top + south_north + west_east_stag ~ model, value.var = "U") %>%
.[bottom_top == 1] %>%
ggplot(aes(west_east_stag, south_north)) +
geom_contour_fill(aes(z = (ana187 - guess))) +
scale_fill_viridis_c() +
coord_fixed() +
labs(title = "ana-guess en el viento zonal")
dcast(model, bottom_top + south_north + west_east_stag ~ model, value.var = "U") %>%
.[bottom_top == 1] %>%
ggplot(aes(west_east_stag, south_north)) +
geom_contour(aes(z = (ana187 - guess))) +
scale_fill_viridis_c() +
coord_fixed() +
labs(title = "ana-guess en el viento zonal")
b <- dcast(model, bottom_top + south_north + west_east_stag ~ model, value.var = "U")
range(b$ana187-b$guess)
View(b)
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(metR)
library(data.table)
library(dplyr)
library(lubridate)
library(patchwork)
map <- rnaturalearth::ne_states(country = c("argentina", "Brazil", "Chile", "Uruguay", "Paraguay", "Bolivia"), returnclass = "sf")
proj <- paste0("+proj=lcc +lat_1=-30.966 +lat_2=-30.966 +lat_0=-30.966 +lon_0=-63.567",
" +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs")
files <- Sys.glob("E1/diagfiles/asim*")
obs <- lapply(files, function(f) {
date_time <- ymd_hms(substr(basename(f), 11, 24))
ens <- substr(basename(f), 29, 31)
fread(f, na.strings = c("0.100E+11", "-0.100E+06", "-99999.90", "-100000.00")) %>%
.[, date.time := date_time] %>%
.[, ens := ens] %>%
.[]
}) %>%
rbindlist() %>%
.[, c("V2", "V4") := NULL]
colnames(obs) <- c("var", "stationID", "type", "dhr", "lat", "lon", "pressure", "usage.flag", "obs", "obs.guess", "obs2", "obs.guess2", "rerr", "date.time", "ens")
obs[usage.flag == 1 & ens == "001" & rerr < 5e9] %>%
ggplot(aes(obs.guess)) +
geom_density(aes(color = var)) +
geom_rug() +
facet_wrap(~factor(var), scales = "free") +
theme(legend.position = "none") +
obs[usage.flag == 1 & rerr < 5e9] %>%
ggplot(aes(obs.guess, rerr)) +
geom_point(alpha = 0.05, size = 0.5) +
facet_wrap(~var, scales = "free")
